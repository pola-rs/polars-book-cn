<!DOCTYPE HTML>
<html lang="zh-CN" class="sidebar-visible no-js ayu">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>æ—¶é—´åºåˆ— - Polars - ç”¨æˆ·æŒ‡å—</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <link rel="stylesheet" href="../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction.html"><strong aria-hidden="true">1.</strong> ä»‹ç»</a></li><li class="chapter-item expanded "><a href="../quickstart/intro.html"><strong aria-hidden="true">2.</strong> å¼€å§‹ä½¿ç”¨</a></li><li class="chapter-item expanded "><a href="../dsl/intro.html"><strong aria-hidden="true">3.</strong> Polars è¡¨è¾¾å¼</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../dsl/expressions.html"><strong aria-hidden="true">3.1.</strong> è¡¨è¾¾å¼</a></li><li class="chapter-item "><a href="../dsl/contexts.html"><strong aria-hidden="true">3.2.</strong> ä¸Šä¸‹æ–‡</a></li><li class="chapter-item "><a href="../dsl/groupby.html"><strong aria-hidden="true">3.3.</strong> åˆ†ç»„</a></li><li class="chapter-item "><a href="../dsl/folds.html"><strong aria-hidden="true">3.4.</strong> æŠ˜å </a></li><li class="chapter-item "><a href="../dsl/custom_functions.html"><strong aria-hidden="true">3.5.</strong> è‡ªå®šä¹‰å‡½æ•°</a></li><li class="chapter-item "><a href="../dsl/window_functions.html"><strong aria-hidden="true">3.6.</strong> çª—å£å‡½æ•°</a></li><li class="chapter-item "><a href="../dsl/numpy.html"><strong aria-hidden="true">3.7.</strong> Numpy é€šç”¨å‡½æ•°</a></li><li class="chapter-item "><a href="../notebooks/introduction_polars.html"><strong aria-hidden="true">3.8.</strong> ç¤ºä¾‹</a></li><li class="chapter-item "><a href="../dsl/api.html"><strong aria-hidden="true">3.9.</strong> æ–¹æ³•</a></li><li class="chapter-item "><a href="../dsl/video_intro.html"><strong aria-hidden="true">3.10.</strong> è§†é¢‘ä»‹ç»</a></li></ol></li><li class="chapter-item expanded "><a href="../indexing.html"><strong aria-hidden="true">4.</strong> ç´¢å¼•</a></li><li class="chapter-item expanded "><a href="../datatypes.html"><strong aria-hidden="true">5.</strong> æ•°æ®ç±»å‹</a></li><li class="chapter-item expanded "><a href="../coming_from_pandas.html"><strong aria-hidden="true">6.</strong> æ¥è‡ª Pandas</a></li><li class="chapter-item expanded "><a href="../coming_from_spark.html"><strong aria-hidden="true">7.</strong> æ¥è‡ª Apache Spark</a></li><li class="chapter-item expanded "><a href="../timeseries/intro.html" class="active"><strong aria-hidden="true">8.</strong> æ—¶é—´åºåˆ—</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../time-series.html"><strong aria-hidden="true">8.1.</strong> ç¤ºä¾‹</a></li></ol></li><li class="chapter-item expanded "><a href="../howcani/intro.html"><strong aria-hidden="true">9.</strong> ä½¿ç”¨èŒƒå›´</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../howcani/io/intro.html"><strong aria-hidden="true">9.1.</strong> IO</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../howcani/io/csv.html"><strong aria-hidden="true">9.1.1.</strong> CSV æ–‡ä»¶</a></li><li class="chapter-item "><a href="../howcani/io/parquet.html"><strong aria-hidden="true">9.1.2.</strong> Parquet æ–‡ä»¶</a></li><li class="chapter-item "><a href="../multiple_files/intro.html"><strong aria-hidden="true">9.1.3.</strong> å¤šæ–‡ä»¶</a></li><li class="chapter-item "><a href="../howcani/io/read_db.html"><strong aria-hidden="true">9.1.4.</strong> ä»æ•°æ®åº“ä¸­è¯»å–</a></li><li class="chapter-item "><a href="../howcani/io/aws.html"><strong aria-hidden="true">9.1.5.</strong> ä¸ AWS äº¤äº’</a></li><li class="chapter-item "><a href="../howcani/io/google-big-query.html"><strong aria-hidden="true">9.1.6.</strong> ä¸ Google BigQuery äº¤äº’</a></li><li class="chapter-item "><a href="../howcani/io/postgres.html"><strong aria-hidden="true">9.1.7.</strong> ä¸ Postgres äº¤äº’</a></li></ol></li><li class="chapter-item "><a href="../howcani/interop/intro.html"><strong aria-hidden="true">9.2.</strong> äº’é€šæ€§</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../howcani/interop/arrow.html"><strong aria-hidden="true">9.2.1.</strong> Arrow</a></li><li class="chapter-item "><a href="../howcani/interop/numpy.html"><strong aria-hidden="true">9.2.2.</strong> Numpy</a></li></ol></li><li class="chapter-item "><a href="../howcani/data/intro.html"><strong aria-hidden="true">9.3.</strong> æ•°æ®</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../howcani/data/strings.html"><strong aria-hidden="true">9.3.1.</strong> å­—ç¬¦ä¸²</a></li><li class="chapter-item "><a href="../howcani/data/timestamps.html"><strong aria-hidden="true">9.3.2.</strong> æ—¶é—´æˆ³</a></li></ol></li><li class="chapter-item "><a href="../howcani/df/intro.html"><strong aria-hidden="true">9.4.</strong> æ•°æ®å¸§</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../howcani/df/row_col_selection.html"><strong aria-hidden="true">9.4.1.</strong> é€‰ä¸­</a></li><li class="chapter-item "><a href="../howcani/df/common-manipulations.html"><strong aria-hidden="true">9.4.2.</strong> å¸¸ç”¨</a></li><li class="chapter-item "><a href="../howcani/df/groupby.html"><strong aria-hidden="true">9.4.3.</strong> åˆ†ç»„</a></li><li class="chapter-item "><a href="../howcani/df/aggregate.html"><strong aria-hidden="true">9.4.4.</strong> èšåˆ</a></li><li class="chapter-item "><a href="../howcani/df/filter.html"><strong aria-hidden="true">9.4.5.</strong> è¿‡æ»¤</a></li><li class="chapter-item "><a href="../howcani/df/join.html"><strong aria-hidden="true">9.4.6.</strong> è¿æ¥</a></li><li class="chapter-item "><a href="../howcani/df/melt.html"><strong aria-hidden="true">9.4.7.</strong> é‡å¡‘</a></li><li class="chapter-item "><a href="../howcani/df/pivot.html"><strong aria-hidden="true">9.4.8.</strong> é€è§†</a></li><li class="chapter-item "><a href="../howcani/df/sorting.html"><strong aria-hidden="true">9.4.9.</strong> æ’åº</a></li><li class="chapter-item "><a href="../howcani/df/conditionally-apply.html"><strong aria-hidden="true">9.4.10.</strong> æ¡ä»¶åº”ç”¨</a></li></ol></li><li class="chapter-item "><a href="../howcani/apply/intro.html"><strong aria-hidden="true">9.5.</strong> åº”ç”¨</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../howcani/apply/udfs.html"><strong aria-hidden="true">9.5.1.</strong> è‡ªå®šä¹‰å‡½æ•°</a></li><li class="chapter-item "><a href="../howcani/apply/window-functions.html"><strong aria-hidden="true">9.5.2.</strong> çª—å£å‡½æ•°</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../performance/intro.html"><strong aria-hidden="true">10.</strong> æ€§èƒ½</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../performance/strings.html"><strong aria-hidden="true">10.1.</strong> å­—ç¬¦ä¸²</a></li></ol></li><li class="chapter-item expanded "><a href="../optimizations/intro.html"><strong aria-hidden="true">11.</strong> ä¼˜åŒ–</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../optimizations/lazy/intro.html"><strong aria-hidden="true">11.1.</strong> æƒ°æ€§æ–¹æ³•</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../optimizations/lazy/predicate-pushdown.html"><strong aria-hidden="true">11.1.1.</strong> è°“è¯ä¸‹æ¨</a></li><li class="chapter-item "><a href="../optimizations/lazy/projection-pushdown.html"><strong aria-hidden="true">11.1.2.</strong> æŠ•å½±ä¸‹æ¨</a></li><li class="chapter-item "><a href="../optimizations/lazy/other-optimizations.html"><strong aria-hidden="true">11.1.3.</strong> å…¶å®ƒä¼˜åŒ–</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../references.html"><strong aria-hidden="true">12.</strong> å‚è€ƒæŒ‡å—</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu (default)</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Polars - ç”¨æˆ·æŒ‡å—</h1>

                    <div class="right-buttons">
                        
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="æ—¶é—´åºåˆ—"><a class="header" href="#æ—¶é—´åºåˆ—">æ—¶é—´åºåˆ—</a></h1>
<p><code>Polars</code> ä¸ºæ—¶é—´åºåˆ—é‡é‡‡æ ·æä¾›äº†å¼ºå¤§çš„æ–¹æ³•æ”¯æŒã€‚è®¸å¤šäººéƒ½çŸ¥é“ <code>Pandas</code> ä¸­ <code>df.resample</code> æä¾›äº†é‡é‡‡æ ·åŠŸèƒ½ã€‚</p>
<p><code>Polars</code> åœ¨ä»¥ä¸‹ä¸¤ä¸ªæ–¹é¢ä¸ <code>Pandas</code> æœ‰æ‰€åŒºåˆ«ï¼š</p>
<ul>
<li>ä¸Šé‡‡æ · (Up Sampling)</li>
<li>ä¸‹é‡‡æ · (Down Sampling)</li>
</ul>
<h2 id="ä¸Šé‡‡æ ·-up-sampling"><a class="header" href="#ä¸Šé‡‡æ ·-up-sampling">ä¸Šé‡‡æ · (Up Sampling)</a></h2>
<p>ä¸Šé‡‡æ ·å®é™…ä¸Šç›¸å½“äºå°†ä¸€ä¸ªæ—¥æœŸèŒƒå›´ä¸ä½ çš„æ•°æ®é›†è¿›è¡Œå·¦å…³è” (left join) æ“ä½œï¼Œå¹¶å¡«å……ç¼ºå¤±æ•°æ®ã€‚<code>Polars</code> ä¸ºæ­¤æ“ä½œ
æä¾›äº†å°è£…æ–¹æ³•ï¼Œä½ å¯ä»¥å‚è€ƒä¸‹é¢çš„ä¸€ä¸ªç¤ºä¾‹ã€‚</p>
<pre><code class="language-python">df = pl.DataFrame(
    {
        &quot;time&quot;: pl.date_range(start=datetime(2021, 12, 16), end=datetime(2021, 12, 16, 3), interval=&quot;30m&quot;, eager=True),
        &quot;groups&quot;: [&quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;b&quot;, &quot;b&quot;, &quot;a&quot;, &quot;a&quot;],
        &quot;values&quot;: [1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0],
    }
)
out1 = df.upsample(time_column=&quot;time&quot;, every=&quot;15m&quot;).fill_null(strategy=&quot;forward&quot;)

out2 = df.upsample(time_column=&quot;time&quot;, every=&quot;15m&quot;).interpolate().fill_null(strategy=&quot;forward&quot;)
</code></pre>
<h2 id="ä¸‹é‡‡æ ·-down-sampling"><a class="header" href="#ä¸‹é‡‡æ ·-down-sampling">ä¸‹é‡‡æ · (Down Sampling)</a></h2>
<p>ä¸‹é‡‡æ ·å¾ˆæœ‰æ„æ€ã€‚ä½ éœ€è¦å¤„ç†æ—¥æœŸé—´éš”ã€çª—å£æŒç»­æ—¶é—´ã€èšåˆç­‰é—®é¢˜ã€‚</p>
<p><code>Polars</code> å°†ä¸‹é‡‡æ ·è§†ä¸ºåˆ†ç»„ï¼ˆgroupbyï¼‰æ“ä½œçš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œå› æ­¤è¡¨è¾¾å¼ API ä¸ºåˆ†ç»„ï¼ˆgroupbyï¼‰ä¸Šä¸‹æ–‡ï¼ˆcontextsï¼‰æä¾›äº†ä¸¤ä¸ªé¢å¤–çš„å…¥å£ã€‚</p>
<ul>
<li><a href="https://pola-rs.github.io/polars/py-polars/html/reference/api/polars.DataFrame.groupby_dynamic.html">groupby_dynamic</a></li>
<li><a href="https://pola-rs.github.io/polars/py-polars/html/reference/api/polars.DataFrame.groupby_rolling.html">groupby_rolling</a></li>
</ul>
<p>ä½ å¯ä»¥é€šè¿‡è°ƒç”¨äºŒè€…å…¶ä¸­ä»»ä½•ä¸€ä¸ªå‡½æ•°æ¥è·å–å¯¹è¡¨è¾¾å¼æ–¹æ³•çš„å®Œæ•´è®¿é—®ï¼Œå®ƒæœ‰ç€å¼ºå¤§çš„æ€§èƒ½ï¼</p>
<p>è®©æˆ‘ä»¬é€šè¿‡ä¸‹é¢å‡ ä¸ªç¤ºä¾‹æ¥ç†è§£è¿™æ ·åšçš„æ„ä¹‰ã€‚</p>
<pre><code class="language-python">df = pl.DataFrame(
    {
        &quot;time&quot;: pl.date_range(
            start=datetime(2021, 12, 16),
            end=datetime(2021, 12, 16, 3),
            interval=&quot;30m&quot;,
            eager=True,
        ),
        &quot;groups&quot;: [&quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;b&quot;, &quot;b&quot;, &quot;a&quot;, &quot;a&quot;],
    }
)
</code></pre>
<pre><code class="language-python">out = df.groupby_dynamic(
    &quot;time&quot;,
    every=&quot;1h&quot;,
    closed=&quot;both&quot;,
    by=&quot;groups&quot;,
    include_boundaries=True,
).agg([pl.count()])
</code></pre>
<h2 id="åŠ¨æ€åˆ†ç»„-groupby-dynamic"><a class="header" href="#åŠ¨æ€åˆ†ç»„-groupby-dynamic">åŠ¨æ€åˆ†ç»„ (Groupby Dynamic)</a></h2>
<p>åœ¨ä¸‹é¢çš„ä¸€æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬ä»¥ <strong>å¤©</strong> (<code>&quot;1d&quot;</code>) ä¸ºå•ä½ï¼ŒæŠŠå…³äº 2021 å¹´çš„ <code>æ—¥æœŸèŒƒå›´ (date range)</code> åˆ›å»ºä¸ºä¸€ä¸ª <code>DataFrame</code>ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ›å»ºèµ·å§‹äºæ¯ <strong>æœˆ</strong> (<code>&quot;1mo&quot;</code>)ï¼Œé•¿åº¦ä¸º <code>1</code> ä¸ªæœˆçš„åŠ¨æ€çª—å£ (dynamic windows)ã€‚åŠ¨æ€çª—å£çš„å¤§å°å¹¶ä¸ç”± <code>DataFrame</code>
ä¸­çš„è¡Œæ•°å†³å®šï¼Œè€Œæ˜¯ç”±ä¸€ä¸ªæ—¶é—´å•ä½ (temporal unit) å†³å®šï¼Œæ¯”å¦‚ä¸€å¤© (<code>&quot;1d&quot;</code>)ï¼Œä¸‰å‘¨ (<code>&quot;3w&quot;</code>)ï¼Œäº¦æˆ–æ˜¯äº”çº³ç§’ (<code>&quot;5ns&quot;</code>) ...
å¸Œæœ›è¿™ä¸ªä¾‹å­æœ‰åŠ©äºè®©ä½ ç†è§£åŠ¨æ€çª—å£çš„å«ä¹‰ã€‚</p>
<p>åŒ¹é…æŸä¸ªåŠ¨æ€çª—å£çš„å€¼ä¼šè¢«åˆ†é…åˆ°è¯¥çª—å£æ‰€å¯¹åº”çš„ç»„ä¸­ï¼Œæ¥ä¸‹æ¥ä½ å¯ä»¥ç”¨å¼ºå¤§çš„è¡¨è¾¾å¼æ–¹æ³•è¿›è¡Œèšåˆæ“ä½œã€‚</p>
<p>ä¸‹é¢çš„ç¤ºä¾‹ä½¿ç”¨ <strong>groupby_dynamic</strong> æ¥è®¡ç®—ï¼š</p>
<ul>
<li>è·ç¦»æœˆåº•çš„å¤©æ•°</li>
<li>ä¸€ä¸ªæœˆé‡Œçš„å¤©æ•°</li>
</ul>
<pre><code class="language-python"># æ—¶é—´è½´ï¼ˆä»lowåˆ°highï¼Œé—´éš”ä¸º1å¤©ï¼Œè½´åç§°ä¸º&quot;time&quot;ï¼‰
df = pl.date_range(start=datetime(2021, 1, 1), 
                   end=datetime(2021, 12, 31), 
                   interval=&quot;1d&quot;, 
                   name=&quot;time&quot;, 
                   eager=True).to_frame()

out = (
    df.groupby_dynamic(&quot;time&quot;, every=&quot;1mo&quot;, period=&quot;1mo&quot;, closed=&quot;left&quot;)
    .agg(
        [
            pl.col(&quot;time&quot;).cumcount().reverse().head(3).alias(&quot;day/eom&quot;),
            ((pl.col(&quot;time&quot;) - pl.col(&quot;time&quot;).first()).last().dt.days() + 1).alias(&quot;days_in_month&quot;),
        ]
    )
    .explode(&quot;day/eom&quot;)
)
print(out)
</code></pre>
<pre><code class="language-text">shape: (36, 3)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ time                â”† day/eom â”† days_in_month â”‚
â”‚ ---                 â”† ---     â”† ---           â”‚
â”‚ datetime[Î¼s]        â”† u32     â”† i64           â”‚
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¡
â”‚ 2021-01-01 00:00:00 â”† 30      â”† 31            â”‚
â”‚ 2021-01-01 00:00:00 â”† 29      â”† 31            â”‚
â”‚ 2021-01-01 00:00:00 â”† 28      â”† 31            â”‚
â”‚ 2021-02-01 00:00:00 â”† 27      â”† 28            â”‚
â”‚ â€¦                   â”† â€¦       â”† â€¦             â”‚
â”‚ 2021-11-01 00:00:00 â”† 27      â”† 30            â”‚
â”‚ 2021-12-01 00:00:00 â”† 30      â”† 31            â”‚
â”‚ 2021-12-01 00:00:00 â”† 29      â”† 31            â”‚
â”‚ 2021-12-01 00:00:00 â”† 28      â”† 31            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p>è¦å®šä¹‰ä¸€ä¸ªåŠ¨æ€çª—å£ï¼Œéœ€è¦æä¾›ä»¥ä¸‹ä¸‰ä¸ªå‚æ•°ï¼š</p>
<ul>
<li><strong>every</strong>ï¼šçª—å£çš„æ—¶é—´é—´éš”</li>
<li><strong>period</strong>ï¼šçª—å£çš„æŒç»­æ—¶é—´</li>
<li><strong>offset</strong>ï¼šå¯ä»¥å¯¹çª—å£çš„å¼€å§‹è¿›è¡Œåç§»</li>
</ul>
<p>å› ä¸º <em><strong>every</strong></em> å¹¶ä¸æ€»æ˜¯éœ€è¦ç­‰äº <em><strong>period</strong></em>ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ç§éå¸¸çµæ´»çš„æ–¹å¼æ¥åˆ›å»ºå¾ˆå¤šç»„åˆ«ã€‚å®ƒä»¬å¯ä»¥äº’ç›¸é‡å ï¼Œä¹Ÿå¯ä»¥åœ¨ç»„é—´ç•™å‡ºè¾¹ç•Œã€‚</p>
<p>æˆ‘ä»¬å…ˆä»ç®€å•çš„ä¾‹å­å¼€å§‹ ğŸ¥± æƒ³æƒ³çœ‹ä¸‹é¢å‡ ç»„å‚æ•°ä¼šåˆ›å»ºå‡ºæ€ä¹ˆæ ·çš„çª—å£ã€‚</p>
<blockquote>
</blockquote>
<ul>
<li>every: 1 å¤© -&gt; <code>&quot;1d&quot;</code></li>
<li>period: 1 å¤© -&gt; <code>&quot;1d&quot;</code></li>
</ul>
<pre><code class="language-text">åˆ›å»ºå‡ºçš„çª—å£ç›¸é‚»ï¼Œä¸”é•¿åº¦ç›¸ç­‰
|--|
   |--|
      |--|
</code></pre>
<blockquote>
</blockquote>
<ul>
<li>every: 1 å¤© -&gt; <code>&quot;1d&quot;</code></li>
<li>period: 2 å¤© -&gt; <code>&quot;2d&quot;</code></li>
</ul>
<pre><code class="language-text">çª—å£ä¹‹é—´æœ‰ 1 å¤©çš„é‡å 
|----|
   |----|
      |----|
</code></pre>
<blockquote>
</blockquote>
<ul>
<li>every: 2 å¤© -&gt; <code>&quot;2d&quot;</code></li>
<li>period: 1 å¤© -&gt; <code>&quot;1d&quot;</code></li>
</ul>
<pre><code class="language-text">ä¸¤ä¸ªçª—å£ä¹‹é—´ç•™æœ‰é—´éš”ï¼Œåœ¨è¿™æ®µèŒƒå›´å†…çš„æ•°æ®ä¸å±äºä»»ä½•ä¸€ä¸ªç»„åˆ«
|--|
       |--|
              |--|
</code></pre>
<h2 id="æ»šåŠ¨åˆ†ç»„-rolling-groupby"><a class="header" href="#æ»šåŠ¨åˆ†ç»„-rolling-groupby">æ»šåŠ¨åˆ†ç»„ (Rolling Groupby)</a></h2>
<p>æ»šåŠ¨åˆ†ç»„æ˜¯åˆ†ç»„ï¼ˆgroupbyï¼‰ä¸Šä¸‹æ–‡çš„å¦ä¸€ä¸ªå…¥å£ã€‚ä½†ä¸ <code>groupby_dynamic</code> ä¸åŒçš„æ˜¯ï¼Œçª—å£çš„è®¾ç½®ä¸æ¥å—å‚æ•° <code>every</code> å’Œ <code>period</code> â€”â€” å¯¹äºä¸€ä¸ªæ»šåŠ¨åˆ†ç»„ï¼Œçª—å£ä¸æ˜¯å›ºå®šçš„ï¼å®ƒä»¬ç”± <code>index_column</code> ä¸­çš„å€¼å†³å®šã€‚</p>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æœ‰ä¸€ä¸ªå€¼ä¸º<code>{2021-01-01, 20210-01-05}</code> çš„æ—¶é—´åºåˆ—ï¼Œä½¿ç”¨å‚æ•° <code>period=&quot;5d&quot;</code> å°†åˆ›å»ºä»¥ä¸‹çª—å£ï¼š</p>
<pre><code class="language-text">
2021-01-01   2021-01-06
    |----------|

       2021-01-05   2021-01-10
             |----------|
</code></pre>
<p>ç”±äºæ»šåŠ¨åˆ†ç»„çš„çª—å£æ€»æ˜¯ç”± <code>DataFrame</code> åˆ—ä¸­çš„å€¼å†³å®šï¼Œç»„åˆ«çš„æ•°ç›®æ€»æ˜¯ä¸åŸ <code>DataFrame</code> ç›¸ç­‰ã€‚</p>
<h2 id="å°†åŠ¨æ€åˆ†ç»„ä¸æ»šåŠ¨åˆ†ç»„ç»“åˆèµ·æ¥"><a class="header" href="#å°†åŠ¨æ€åˆ†ç»„ä¸æ»šåŠ¨åˆ†ç»„ç»“åˆèµ·æ¥">å°†åŠ¨æ€åˆ†ç»„ä¸æ»šåŠ¨åˆ†ç»„ç»“åˆèµ·æ¥</a></h2>
<p>ç”¨æ­£å¸¸çš„ groupby æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸¤ç§åˆ†ç»„æ–¹å¼ç»“åˆèµ·æ¥ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨åŠ¨æ€åˆ†ç»„çš„ä¾‹å­ï¼š</p>
<pre><code class="language-python">from datetime import datetime

import polars as pl

df = pl.DataFrame(
    {
        &quot;time&quot;: pl.date_range(
            start=datetime(2021, 12, 16),
            end=datetime(2021, 12, 16, 3),
            interval=&quot;30m&quot;,
            eager=True,
        ),
        &quot;groups&quot;: [&quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;b&quot;, &quot;b&quot;, &quot;a&quot;, &quot;a&quot;],
    }
)
print(out)
</code></pre>
<pre><code class="language-text">shape: (7, 2)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ time                â”† groups â”‚
â”‚ ---                 â”† ---    â”‚
â”‚ datetime[Î¼s]        â”† str    â”‚
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•¡
â”‚ 2021-12-16 00:00:00 â”† a      â”‚
â”‚ 2021-12-16 00:30:00 â”† a      â”‚
â”‚ 2021-12-16 01:00:00 â”† a      â”‚
â”‚ 2021-12-16 01:30:00 â”† b      â”‚
â”‚ 2021-12-16 02:00:00 â”† b      â”‚
â”‚ 2021-12-16 02:30:00 â”† a      â”‚
â”‚ 2021-12-16 03:00:00 â”† a      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<pre><code class="language-python"># åŠ¨æ€åˆ†ç»„
out = df.groupby_dynamic(
    &quot;time&quot;,
    every=&quot;1h&quot;,
    closed=&quot;both&quot;,
    by=&quot;groups&quot;,
    include_boundaries=True,
).agg([pl.count()])
print(df)
</code></pre>
<pre><code class="language-text">shape: (7, 5)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”
â”‚ groups â”† _lower_boundary     â”† _upper_boundary     â”† time                â”† count â”‚
â”‚ ---    â”† ---                 â”† ---                 â”† ---                 â”† ---   â”‚
â”‚ str    â”† datetime[Î¼s]        â”† datetime[Î¼s]        â”† datetime[Î¼s]        â”† u32   â”‚
â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•¡
â”‚ a      â”† 2021-12-15 23:00:00 â”† 2021-12-16 00:00:00 â”† 2021-12-15 23:00:00 â”† 1     â”‚
â”‚ a      â”† 2021-12-16 00:00:00 â”† 2021-12-16 01:00:00 â”† 2021-12-16 00:00:00 â”† 3     â”‚
â”‚ a      â”† 2021-12-16 01:00:00 â”† 2021-12-16 02:00:00 â”† 2021-12-16 01:00:00 â”† 1     â”‚
â”‚ a      â”† 2021-12-16 02:00:00 â”† 2021-12-16 03:00:00 â”† 2021-12-16 02:00:00 â”† 2     â”‚
â”‚ a      â”† 2021-12-16 03:00:00 â”† 2021-12-16 04:00:00 â”† 2021-12-16 03:00:00 â”† 1     â”‚
â”‚ b      â”† 2021-12-16 01:00:00 â”† 2021-12-16 02:00:00 â”† 2021-12-16 01:00:00 â”† 2     â”‚
â”‚ b      â”† 2021-12-16 02:00:00 â”† 2021-12-16 03:00:00 â”† 2021-12-16 02:00:00 â”† 1     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../coming_from_spark.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../time-series.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../coming_from_spark.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../time-series.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
