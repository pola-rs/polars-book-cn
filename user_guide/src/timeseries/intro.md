# æ—¶é—´åºåˆ—

`Polars` ä¸ºæ—¶é—´åºåˆ—é‡é‡‡æ ·æä¾›äº†å¼ºå¤§çš„æ–¹æ³•æ”¯æŒã€‚è®¸å¤šäººéƒ½çŸ¥é“ `Pandas` ä¸­ `df.resample` æä¾›äº†é‡é‡‡æ ·åŠŸèƒ½ã€‚

`Polars` åœ¨ä»¥ä¸‹ä¸¤ä¸ªæ–¹é¢ä¸ `Pandas` æœ‰æ‰€åŒºåˆ«ï¼š

- ä¸Šé‡‡æ · (Up Sampling)
- ä¸‹é‡‡æ · (Down Sampling)

## ä¸Šé‡‡æ · (Up Sampling)

ä¸Šé‡‡æ ·å®é™…ä¸Šç›¸å½“äºå°†ä¸€ä¸ªæ—¥æœŸèŒƒå›´ä¸ä½ çš„æ•°æ®é›†è¿›è¡Œå·¦å…³è” (left join) æ“ä½œï¼Œå¹¶å¡«å……ç¼ºå¤±æ•°æ®ã€‚`Polars` ä¸ºæ­¤æ“ä½œ
æä¾›äº†å°è£…æ–¹æ³•ï¼Œä½ å¯ä»¥å‚è€ƒä¸‹é¢çš„ä¸€ä¸ªç¤ºä¾‹ã€‚

```python
{{#include ../examples/time_series/resampling_example.py:5:}}
```

## ä¸‹é‡‡æ · (Down Sampling)

ä¸‹é‡‡æ ·å¾ˆæœ‰æ„æ€ã€‚ä½ éœ€è¦å¤„ç†æ—¥æœŸé—´éš”ã€çª—å£æŒç»­æ—¶é—´ã€èšåˆç­‰é—®é¢˜ã€‚

`Polars` å°†ä¸‹é‡‡æ ·è§†ä¸ºåˆ†ç»„ï¼ˆgroupbyï¼‰æ“ä½œçš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œå› æ­¤è¡¨è¾¾å¼ API ä¸ºåˆ†ç»„ï¼ˆgroupbyï¼‰ä¸Šä¸‹æ–‡ï¼ˆcontextsï¼‰æä¾›äº†ä¸¤ä¸ªé¢å¤–çš„å…¥å£ã€‚

- [groupby_dynamic](POLARS_PY_REF_GUIDE/api/polars.DataFrame.groupby_dynamic.html)
- [groupby_rolling](POLARS_PY_REF_GUIDE/api/polars.DataFrame.groupby_rolling.html)

ä½ å¯ä»¥é€šè¿‡è°ƒç”¨äºŒè€…å…¶ä¸­ä»»ä½•ä¸€ä¸ªå‡½æ•°æ¥è·å–å¯¹è¡¨è¾¾å¼æ–¹æ³•çš„å®Œæ•´è®¿é—®ï¼Œå®ƒæœ‰ç€å¼ºå¤§çš„æ€§èƒ½ï¼

è®©æˆ‘ä»¬é€šè¿‡ä¸‹é¢å‡ ä¸ªç¤ºä¾‹æ¥ç†è§£è¿™æ ·åšçš„æ„ä¹‰ã€‚

```python
{{#include ../examples/time_series/dynamic_ds.py:5:}}
```

```python
{{#include ../examples/time_series/dynamic_groupby.py:5:}}
```

## åŠ¨æ€åˆ†ç»„ (Groupby Dynamic)

åœ¨ä¸‹é¢çš„ä¸€æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬ä»¥ **å¤©** (`"1d"`) ä¸ºå•ä½ï¼ŒæŠŠå…³äº 2021 å¹´çš„ `æ—¥æœŸèŒƒå›´ (date range)` åˆ›å»ºä¸ºä¸€ä¸ª `DataFrame`ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ›å»ºèµ·å§‹äºæ¯ **æœˆ** (`"1mo"`)ï¼Œé•¿åº¦ä¸º `1` ä¸ªæœˆçš„åŠ¨æ€çª—å£ (dynamic windows)ã€‚åŠ¨æ€çª—å£çš„å¤§å°å¹¶ä¸ç”± `DataFrame`
ä¸­çš„è¡Œæ•°å†³å®šï¼Œè€Œæ˜¯ç”±ä¸€ä¸ªæ—¶é—´å•ä½ (temporal unit) å†³å®šï¼Œæ¯”å¦‚ä¸€å¤© (`"1d"`)ï¼Œä¸‰å‘¨ (`"3w"`)ï¼Œäº¦æˆ–æ˜¯äº”çº³ç§’ (`"5ns"`) ...
å¸Œæœ›è¿™ä¸ªä¾‹å­æœ‰åŠ©äºè®©ä½ ç†è§£åŠ¨æ€çª—å£çš„å«ä¹‰ã€‚

åŒ¹é…æŸä¸ªåŠ¨æ€çª—å£çš„å€¼ä¼šè¢«åˆ†é…åˆ°è¯¥çª—å£æ‰€å¯¹åº”çš„ç»„ä¸­ï¼Œæ¥ä¸‹æ¥ä½ å¯ä»¥ç”¨å¼ºå¤§çš„è¡¨è¾¾å¼æ–¹æ³•è¿›è¡Œèšåˆæ“ä½œã€‚

ä¸‹é¢çš„ç¤ºä¾‹ä½¿ç”¨ **groupby_dynamic** æ¥è®¡ç®—ï¼š

- è·ç¦»æœˆåº•çš„å¤©æ•°
- ä¸€ä¸ªæœˆé‡Œçš„å¤©æ•°

```python
{{#include ../examples/time_series/days_month.py:4:}}
print(out)
```

```text
{{#include ../outputs/time_series/days_month.txt}}
```

è¦å®šä¹‰ä¸€ä¸ªåŠ¨æ€çª—å£ï¼Œéœ€è¦æä¾›ä»¥ä¸‹ä¸‰ä¸ªå‚æ•°ï¼š

- **every**ï¼šçª—å£çš„æ—¶é—´é—´éš”
- **period**ï¼šçª—å£çš„æŒç»­æ—¶é—´
- **offset**ï¼šå¯ä»¥å¯¹çª—å£çš„å¼€å§‹è¿›è¡Œåç§»

å› ä¸º _**every**_ å¹¶ä¸æ€»æ˜¯éœ€è¦ç­‰äº _**period**_ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ç§éå¸¸çµæ´»çš„æ–¹å¼æ¥åˆ›å»ºå¾ˆå¤šç»„åˆ«ã€‚å®ƒä»¬å¯ä»¥äº’ç›¸é‡å ï¼Œä¹Ÿå¯ä»¥åœ¨ç»„é—´ç•™å‡ºè¾¹ç•Œã€‚

æˆ‘ä»¬å…ˆä»ç®€å•çš„ä¾‹å­å¼€å§‹ ğŸ¥± æƒ³æƒ³çœ‹ä¸‹é¢å‡ ç»„å‚æ•°ä¼šåˆ›å»ºå‡ºæ€ä¹ˆæ ·çš„çª—å£ã€‚

>

- every: 1 å¤© -> `"1d"`
- period: 1 å¤© -> `"1d"`

```text
åˆ›å»ºå‡ºçš„çª—å£ç›¸é‚»ï¼Œä¸”é•¿åº¦ç›¸ç­‰
|--|
   |--|
      |--|
```

>

- every: 1 å¤© -> `"1d"`
- period: 2 å¤© -> `"2d"`

```text
çª—å£ä¹‹é—´æœ‰ 1 å¤©çš„é‡å 
|----|
   |----|
      |----|
```

>

- every: 2 å¤© -> `"2d"`
- period: 1 å¤© -> `"1d"`

```text
ä¸¤ä¸ªçª—å£ä¹‹é—´ç•™æœ‰é—´éš”ï¼Œåœ¨è¿™æ®µèŒƒå›´å†…çš„æ•°æ®ä¸å±äºä»»ä½•ä¸€ä¸ªç»„åˆ«
|--|
       |--|
              |--|
```

## æ»šåŠ¨åˆ†ç»„ (Rolling Groupby)

æ»šåŠ¨åˆ†ç»„æ˜¯åˆ†ç»„ï¼ˆgroupbyï¼‰ä¸Šä¸‹æ–‡çš„å¦ä¸€ä¸ªå…¥å£ã€‚ä½†ä¸ `groupby_dynamic` ä¸åŒçš„æ˜¯ï¼Œçª—å£çš„è®¾ç½®ä¸æ¥å—å‚æ•° `every` å’Œ `period` â€”â€” å¯¹äºä¸€ä¸ªæ»šåŠ¨åˆ†ç»„ï¼Œçª—å£ä¸æ˜¯å›ºå®šçš„ï¼å®ƒä»¬ç”± `index_column` ä¸­çš„å€¼å†³å®šã€‚

æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æœ‰ä¸€ä¸ªå€¼ä¸º`{2021-01-01, 20210-01-05}` çš„æ—¶é—´åºåˆ—ï¼Œä½¿ç”¨å‚æ•° `period="5d"` å°†åˆ›å»ºä»¥ä¸‹çª—å£ï¼š

```text

2021-01-01   2021-01-06
    |----------|

       2021-01-05   2021-01-10
             |----------|
```

ç”±äºæ»šåŠ¨åˆ†ç»„çš„çª—å£æ€»æ˜¯ç”± `DataFrame` åˆ—ä¸­çš„å€¼å†³å®šï¼Œç»„åˆ«çš„æ•°ç›®æ€»æ˜¯ä¸åŸ `DataFrame` ç›¸ç­‰ã€‚

## å°†åŠ¨æ€åˆ†ç»„ä¸æ»šåŠ¨åˆ†ç»„ç»“åˆèµ·æ¥

ç”¨æ­£å¸¸çš„ groupby æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸¤ç§åˆ†ç»„æ–¹å¼ç»“åˆèµ·æ¥ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨åŠ¨æ€åˆ†ç»„çš„ä¾‹å­ï¼š

```python
{{#include ../examples/time_series/dynamic_ds.py:0:}}
print(out)
```

```text
{{#include ../outputs/time_series/dyn_df.txt}}
```

```python
{{#include ../examples/time_series/dynamic_groupby.py:4:}}
print(df)
```

```text
{{#include ../outputs/time_series/dyn_gb.txt}}
```
